var _=Object.defineProperty;var p=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var h=(i,e,t)=>e in i?_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v=(i,e)=>{for(var t in e||(e={}))b.call(e,t)&&h(i,t,e[t]);if(p)for(var t of p(e))S.call(e,t)&&h(i,t,e[t]);return i};var c=(i,e,t)=>(h(i,typeof e!="symbol"?e+"":e,t),t);import{j as P,a as A,F as $,s as k,l as g,L as y,c as u,_ as w,p as B,R as T,A as j,S as x}from"./vendor.136ee9b8.js";const C=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}};C();const R="modulepreload",E={},O="./",D=function(e,t){return!t||t.length===0?e():Promise.all(t.map(a=>{if(a=`${O}${a}`,a in E)return;E[a]=!0;const r=a.endsWith(".css"),n=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${n}`))return;const o=document.createElement("link");if(o.rel=r?"stylesheet":R,r||(o.as="script",o.crossOrigin=""),o.href=a,document.head.appendChild(o),r)return new Promise((I,L)=>{o.addEventListener("load",I),o.addEventListener("error",L)})})).then(()=>e())};const m={GH_REPO_URL:"/movies",API_KEY:"8c8e1a50-6322-4135-8875-5d40a5420d86",API_BASE:"https://kinopoiskapiunofficial.tech"},d=i=>m.GH_REPO_URL+i;const s=P,l=A,f=$;var F=i=>{const e=k(null),[t,a]=g(!0);var r=new Image;return r.addEventListener("load",()=>{!e.current||(e.current.style.backgroundImage=`url("${r.src}")`,a(!1))}),r.src=i.image,l(y,{class:u("card",[i.class]),href:i.url,children:[s("div",{class:u("card-img",{loading:t}),ref:e}),s("div",{class:"card-title",children:i.title}),s("div",{class:"card-desc",children:i.description})]})};class H extends w{constructor(e){super(e);c(this,"state");c(this,"refInput",B());c(this,"timeout",0);c(this,"page",1);this.state={movies:[],loadingLazy:!1},this.handleInput=this.handleInput.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleInput(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.handleSubmit(e)},1e3)}handleSubmit(e){clearTimeout(this.timeout),e.preventDefault(),this.searchMovieByName(this.refInput.current.value)}async api(e){const t=await fetch(m.API_BASE+e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":m.API_KEY}});let a=null;try{if(!t.ok)throw new Error("Invalid status");let{films:r}=await t.json();a=r.map(n=>({title:n.nameRu,description:n.year,url:`/movies/${n.filmId}`,image:n.posterUrlPreview}))}catch(r){console.error(r);return}return a}async searchMovieByName(e){const t=await this.api(`/api/v2.1/films/search-by-keyword?keyword=${e}`);this.setState({movies:t}),this.page=1}async searchMovieTop(e){const t=await this.api(`/api/v2.2/films/top?type=TOP_250_BEST_FILMS&page=${e}`);return t.length?(this.setState({movies:[...this.state.movies,...t]}),!1):!0}async componentDidMount(){let e=!1;const t=async()=>{this.setState({loadingLazy:!0});let a=await this.searchMovieTop(this.page++);this.setState({loadingLazy:!1}),!a&&(e=!1)};window.onscroll=async a=>{e||window.innerHeight+window.scrollY>=document.body.offsetHeight-120&&(t(),e=!0)},await t()}render(){const{loadingLazy:e}=this.state;return l(f,{children:[s("form",{class:"home-search",onSubmit:this.handleSubmit,children:l("label",{class:"home-label",children:[s("input",{class:"home-input",type:"text",name:"search",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0444\u0438\u043B\u044C\u043C\u0430 ...",onInput:this.handleInput,ref:this.refInput}),s("svg",{class:"home-icon",width:"24",height:"24",children:s("use",{xlinkHref:"#icon-search"})})]})}),s("div",{class:"cards",children:s("div",{class:"cards-wrapper",children:this.state.movies.map(t=>s(F,v({class:"cards-item"},t)))})}),s("div",{class:u("loader loader-lazy",{loaded:!e}),children:l("div",{class:"loader-wrapper",children:[s("div",{class:"loader-item"}),s("div",{class:"loader-item"}),s("div",{class:"loader-item"})]})})]})}}class M extends w{render(){return s(f,{children:s("div",{class:"error",children:"404"})})}}function z(){let[i,e]=g(!0);return setTimeout(()=>{e(!1)},1e3),l(f,{children:[s("header",{class:"header",children:l("div",{class:"container",children:[s(y,{class:"header-logo",href:d("/"),children:"movies"}),s("div",{class:"header-desc",children:"\u0441\u043C\u043E\u0442\u0440\u0438\u0442\u0435 \u0444\u0438\u043B\u044C\u043C\u044B \u043E\u043D\u043B\u0430\u0439\u043D, \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E"})]})}),l("div",{class:"content container",children:[l(T,{children:[s(H,{path:d("/"),default:!0}),s(M,{path:d("/error")}),s(j,{path:d("/:id"),getComponent:()=>D(()=>import("./movies.fec155bf.js"),["assets/movies.fec155bf.js","assets/movies.0efaa0fe.css","assets/vendor.136ee9b8.js"]).then(t=>t.default),loading:()=>s("span",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 ..."})})]}),s("div",{class:u("loader loader-page",{loaded:!i}),children:l("div",{class:"loader-wrapper",children:[s("div",{class:"loader-item"}),s("div",{class:"loader-item"}),s("div",{class:"loader-item"})]})})]})]})}x(s(z,{}),document.getElementById("app"));export{f as F,s as a,l as j,d as r};
